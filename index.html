<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Melez AI Video Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.7/dist/umd/ffmpeg.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/util@0.12.1/dist/umd/index.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-card: #141414;
            --bg-hover: #1f1f1f;
            --border: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #a3a3a3;
            --accent: #e50914;
            --accent-hover: #f40612;
            --success: #46d369;
            --warning: #e87c03;
            --info: #0071eb;
        }

        body {
            font-family: 'Netflix Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: linear-gradient(to bottom, rgba(0,0,0,0.9) 10%, transparent);
            padding: 20px 4%;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-links {
            display: flex;
            gap: 30px;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.3s;
            cursor: pointer;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--text-primary);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(to bottom, rgba(0,0,0,0.6), var(--bg-primary)),
                        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 600"><rect fill="%23111" width="1200" height="600"/><circle fill="%23222" cx="200" cy="200" r="100"/><circle fill="%23111" cx="800" cy="400" r="150"/></svg>');
            background-size: cover;
            padding: 150px 4% 80px;
            text-align: center;
        }

        .hero h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #fff 0%, #a3a3a3 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto 40px;
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 4%;
        }

        /* Generator Section */
        .generator {
            background: var(--bg-secondary);
            border-radius: 16px;
            border: 1px solid var(--border);
            overflow: hidden;
            margin-bottom: 40px;
        }

        .generator-header {
            padding: 30px;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
        }

        .generator-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .generator-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .generator-body {
            padding: 30px;
        }

        /* Input Groups */
        .input-group {
            margin-bottom: 25px;
        }

        .input-label {
            display: block;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .input-field {
            width: 100%;
            padding: 16px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent);
            background: var(--bg-hover);
        }

        textarea.input-field {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .input-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        /* Custom Select */
        .custom-select {
            position: relative;
        }

        .custom-select select {
            appearance: none;
            width: 100%;
            padding: 16px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            cursor: pointer;
        }

        .custom-select::after {
            content: '‚ñº';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            pointer-events: none;
        }

        /* API Key Section */
        .api-section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid var(--border);
        }

        .api-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .api-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .api-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .api-status.connected {
            background: rgba(70, 211, 105, 0.2);
            color: var(--success);
        }

        .api-status.disconnected {
            background: rgba(229, 9, 20, 0.2);
            color: var(--accent);
        }

        /* Generate Button */
        .generate-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, var(--accent) 0%, #b20710 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(229, 9, 20, 0.4);
        }

        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .generate-btn.loading {
            background: var(--bg-hover);
        }

        /* Results Section */
        .results {
            display: none;
            margin-top: 40px;
        }

        .results.active {
            display: block;
        }

        /* Video Player */
        .video-section {
            background: var(--bg-secondary);
            border-radius: 16px;
            border: 1px solid var(--border);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .video-container {
            position: relative;
            aspect-ratio: 9/16;
            max-height: 600px;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #videoPlayer {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .video-placeholder {
            text-align: center;
            color: var(--text-secondary);
            padding: 40px;
        }

        .video-placeholder-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .video-controls {
            padding: 20px;
            background: var(--bg-card);
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .control-btn {
            padding: 12px 24px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-btn.primary {
            background: var(--accent);
            color: white;
        }

        .control-btn.primary:hover {
            background: var(--accent-hover);
        }

        .control-btn.secondary {
            background: var(--bg-hover);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .control-btn.secondary:hover {
            background: var(--border);
        }

        /* AI Content Cards */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .content-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .content-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .content-title {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .viral-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .viral-badge.high {
            background: rgba(70, 211, 105, 0.2);
            color: var(--success);
        }

        .viral-badge.medium {
            background: rgba(232, 124, 3, 0.2);
            color: var(--warning);
        }

        .content-body {
            padding: 20px;
        }

        .content-text {
            color: var(--text-primary);
            line-height: 1.8;
            font-size: 0.95rem;
        }

        .content-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            padding: 6px 12px;
            background: var(--bg-card);
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .copy-btn {
            margin-top: 15px;
            padding: 10px 20px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Scenes Timeline */
        .scenes-section {
            background: var(--bg-secondary);
            border-radius: 16px;
            border: 1px solid var(--border);
            padding: 30px;
            margin-bottom: 30px;
        }

        .scenes-title {
            font-size: 1.3rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .scenes-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .scene-item {
            display: flex;
            gap: 20px;
            padding: 20px;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .scene-item:hover {
            border-color: var(--accent);
            transform: translateX(5px);
        }

        .scene-number {
            width: 40px;
            height: 40px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }

        .scene-content {
            flex: 1;
        }

        .scene-time {
            font-size: 0.85rem;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .scene-text {
            font-size: 1rem;
            margin-bottom: 8px;
        }

        .scene-visual {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Progress Overlay */
        .progress-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .progress-overlay.active {
            display: flex;
        }

        .progress-container {
            width: 500px;
            max-width: 90%;
            text-align: center;
        }

        .progress-title {
            font-size: 1.5rem;
            margin-bottom: 30px;
        }

        .progress-bar {
            height: 4px;
            background: var(--bg-card);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.3s;
        }

        .progress-status {
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        .progress-details {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 10px;
        }

        /* Loading Animation */
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--bg-card);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 30px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Library Section */
        .library {
            padding: 60px 0;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5rem;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .video-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
            transition: all 0.3s;
            cursor: pointer;
        }

        .video-card:hover {
            transform: scale(1.05);
            border-color: var(--accent);
        }

        .video-thumb {
            aspect-ratio: 9/16;
            background: var(--bg-card);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-duration {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .video-info {
            padding: 20px;
        }

        .video-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .video-meta {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 9998;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 16px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            width: 40px;
            height: 40px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .modal-body {
            padding: 25px;
            overflow-y: auto;
            max-height: calc(90vh - 90px);
        }

        /* Responsive */
        @media (max-width: 968px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .input-row {
                grid-template-columns: 1fr;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-in {
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">üé¨ Melez AI</div>
        <nav class="nav-links">
            <a class="nav-link active" onclick="scrollToSection('generate')">Olu≈ütur</a>
            <a class="nav-link" onclick="scrollToSection('library')">K√ºt√ºphanem</a>
            <a class="nav-link" onclick="showSettings()">Ayarlar</a>
        </nav>
    </header>

    <!-- Hero -->
    <section class="hero">
        <h1>Prompt Yaz, Video Olu≈üsun</h1>
        <p>Yapay zeka ile otomatik video √ºretimi. Trend analizi, senaryo yazƒ±mƒ±, g√∂rsel se√ßimi ve video montajƒ± tek tƒ±kla.</p>
    </section>

    <!-- Main Content -->
    <div class="container">
        <!-- Generator -->
        <section id="generate" class="generator animate-in">
            <div class="generator-header">
                <h2 class="generator-title">üéØ Yeni Video Olu≈ütur</h2>
                <p class="generator-subtitle">Video hakkƒ±nda detaylƒ± bir prompt yazƒ±n, gerisini AI halletsin.</p>
            </div>
            
            <div class="generator-body">
                <!-- API Key -->
                <div class="api-section">
                    <div class="api-header">
                        <span class="api-title">üîë Google Gemini API</span>
                        <span class="api-status disconnected" id="apiStatus">Baƒülƒ± Deƒüil</span>
                    </div>
                    <input type="password" class="input-field" id="apiKey" placeholder="AIzaSy... (API Key'inizi girin)">
                    <button class="copy-btn" onclick="testApiKey()" style="margin-top: 10px;">Baƒülantƒ±yƒ± Test Et</button>
                </div>

                <!-- Prompt Input -->
                <div class="input-group">
                    <label class="input-label">Video Prompt'u</label>
                    <textarea class="input-field" id="videoPrompt" placeholder="√ñrnek: '2024'√ºn en iyi 5 teknoloji √ºr√ºn√ºn√º tanƒ±tan, hƒ±zlƒ± kesimlerle, enerjik m√ºzikli, gen√ßlere hitap eden bir YouTube Shorts videosu. ƒ∞lk 3 saniye dikkat √ßekici olsun.'"></textarea>
                </div>

                <!-- Settings -->
                <div class="input-row">
                    <div class="input-group">
                        <label class="input-label">Format</label>
                        <div class="custom-select">
                            <select id="videoFormat">
                                <option value="shorts">YouTube Shorts (9:16)</option>
                                <option value="tiktok">TikTok (9:16)</option>
                                <option value="reels">Instagram Reels (9:16)</option>
                                <option value="youtube">YouTube Video (16:9)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">S√ºre</label>
                        <div class="custom-select">
                            <select id="videoDuration">
                                <option value="15">15 saniye</option>
                                <option value="30">30 saniye</option>
                                <option value="60" selected>60 saniye</option>
                                <option value="90">90 saniye</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">Dil</label>
                        <div class="custom-select">
                            <select id="videoLanguage">
                                <option value="tr">T√ºrk√ße</option>
                                <option value="en">English</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Generate Button -->
                <button class="generate-btn" id="generateBtn" onclick="generateVideo()">
                    <span>‚ú®</span>
                    <span>Otomatik Video Olu≈ütur</span>
                </button>
            </div>
        </section>

        <!-- Results -->
        <section class="results" id="resultsSection">
            <!-- AI Generated Content -->
            <div class="content-grid">
                <div class="content-card">
                    <div class="content-header">
                        <span class="content-title">üìù Video Ba≈ülƒ±ƒüƒ±</span>
                        <span class="viral-badge high" id="viralScore">Viral: 8.5/10</span>
                    </div>
                    <div class="content-body">
                        <div class="content-text" id="videoTitle">Ba≈ülƒ±k buraya gelecek...</div>
                        <button class="copy-btn" onclick="copyContent('videoTitle')">üìã Kopyala</button>
                    </div>
                </div>

                <div class="content-card">
                    <div class="content-header">
                        <span class="content-title">üìÑ A√ßƒ±klama</span>
                    </div>
                    <div class="content-body">
                        <div class="content-text" id="videoDescription">A√ßƒ±klama buraya gelecek...</div>
                        <button class="copy-btn" onclick="copyContent('videoDescription')">üìã Kopyala</button>
                    </div>
                </div>

                <div class="content-card">
                    <div class="content-header">
                        <span class="content-title">üè∑Ô∏è Etiketler</span>
                    </div>
                    <div class="content-body">
                        <div class="content-tags" id="videoTags">
                            <span class="tag">#tag1</span>
                            <span class="tag">#tag2</span>
                        </div>
                        <button class="copy-btn" onclick="copyContent('videoTags')">üìã Kopyala</button>
                    </div>
                </div>

                <div class="content-card">
                    <div class="content-header">
                        <span class="content-title">üí° Viral Strateji</span>
                    </div>
                    <div class="content-body">
                        <div class="content-text" id="viralStrategy">Strateji buraya gelecek...</div>
                    </div>
                </div>
            </div>

            <!-- Scenes -->
            <div class="scenes-section">
                <h3 class="scenes-title">üé¨ Otomatik Olu≈üturulan Sahneler</h3>
                <div class="scenes-list" id="scenesList">
                    <!-- Scenes will be added here -->
                </div>
            </div>

            <!-- Video Player -->
            <div class="video-section">
                <div class="video-container" id="videoContainer">
                    <div class="video-placeholder">
                        <div class="video-placeholder-icon">üé•</div>
                        <p>Video render edildiƒüinde burada g√∂r√ºnecek</p>
                    </div>
                </div>
                <div class="video-controls">
                    <button class="control-btn primary" onclick="playVideo()" id="playBtn">
                        ‚ñ∂Ô∏è Oynat
                    </button>
                    <button class="control-btn secondary" onclick="downloadVideo()" id="downloadBtn" disabled>
                        üíæ ƒ∞ndir (MP4)
                    </button>
                    <button class="control-btn secondary" onclick="deleteVideo()">
                        üóëÔ∏è Sil
                    </button>
                    <span style="margin-left: auto; color: var(--text-secondary);" id="videoInfo"></span>
                </div>
            </div>
        </section>

        <!-- Library -->
        <section class="library" id="library">
            <div class="section-header">
                <h2 class="section-title">üìÅ Video K√ºt√ºphanem</h2>
                <button class="control-btn secondary" onclick="clearLibrary()">
                    T√ºm√ºn√º Sil
                </button>
            </div>
            <div class="video-grid" id="videoGrid">
                <!-- Videos will be added here -->
            </div>
        </section>
    </div>

    <!-- Progress Overlay -->
    <div class="progress-overlay" id="progressOverlay">
        <div class="progress-container">
            <div class="spinner"></div>
            <h3 class="progress-title" id="progressTitle">AI Analiz Ediyor...</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p class="progress-status" id="progressStatus">Prompt analiz ediliyor...</p>
            <p class="progress-details" id="progressDetails"></p>
        </div>
    </div>

    <!-- Preview Modal -->
    <div class="modal" id="previewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üé¨ Video √ñnizleme</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div style="aspect-ratio: 9/16; max-height: 500px; background: #000; border-radius: 12px; overflow: hidden; margin-bottom: 20px;">
                    <video id="modalVideo" controls style="width: 100%; height: 100%; object-fit: contain;"></video>
                </div>
                <div id="modalVideoInfo"></div>
            </div>
        </div>
    </div>

    <script>
        // ==================== STATE ====================
        let currentProject = null;
        let videoLibrary = JSON.parse(localStorage.getItem('melezVideos') || '[]');
        let ffmpeg = null;
        let isGenerating = false;

        // ==================== INIT ====================
        document.addEventListener('DOMContentLoaded', () => {
            loadApiKey();
            updateLibrary();
            initFFmpeg();
        });

        async function initFFmpeg() {
            try {
                const { FFmpeg } = FFmpegWASM;
                ffmpeg = new FFmpeg();
                console.log('FFmpeg ready to load');
            } catch (e) {
                console.error('FFmpeg init error:', e);
            }
        }

        // ==================== API FUNCTIONS ====================
        function loadApiKey() {
            const saved = localStorage.getItem('geminiApiKey');
            if (saved) {
                document.getElementById('apiKey').value = saved;
                updateApiStatus(true);
            }
        }

        function saveApiKey() {
            const key = document.getElementById('apiKey').value.trim();
            if (key) {
                localStorage.setItem('geminiApiKey', key);
            }
        }

        function updateApiStatus(connected) {
            const status = document.getElementById('apiStatus');
            if (connected) {
                status.textContent = 'Baƒülƒ±';
                status.className = 'api-status connected';
            } else {
                status.textContent = 'Baƒülƒ± Deƒüil';
                status.className = 'api-status disconnected';
            }
        }

        async function testApiKey() {
            const key = document.getElementById('apiKey').value.trim();
            if (!key) {
                alert('API Key girin');
                return;
            }

            try {
                const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=' + key, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: 'Merhaba' }] }]
                    })
                });

                if (response.ok) {
                    updateApiStatus(true);
                    saveApiKey();
                    alert('‚úÖ API baƒülantƒ±sƒ± ba≈üarƒ±lƒ±!');
                } else {
                    throw new Error('API Key ge√ßersiz');
                }
            } catch (error) {
                updateApiStatus(false);
                alert('‚ùå Hata: ' + error.message);
            }
        }

        // ==================== VIDEO GENERATION ====================
        async function generateVideo() {
            if (isGenerating) return;
            
            const prompt = document.getElementById('videoPrompt').value.trim();
            const apiKey = document.getElementById('apiKey').value.trim();
            const format = document.getElementById('videoFormat').value;
            const duration = parseInt(document.getElementById('videoDuration').value);
            const language = document.getElementById('videoLanguage').value;

            if (!prompt) {
                alert('L√ºtfen bir prompt girin');
                return;
            }

            if (!apiKey) {
                alert('L√ºtfen API Key girin');
                return;
            }

            isGenerating = true;
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.classList.add('loading');
            btn.innerHTML = '<span class="spinner" style="width: 20px; height: 20px; margin: 0;"></span><span>Olu≈üturuluyor...</span>';

            try {
                // Step 1: AI Content Generation
                showProgress('ƒ∞√ßerik Olu≈üturuluyor...', 0);
                updateProgress(10, 'AI senaryo yazƒ±yor...');

                const aiPrompt = `Sen bir viral video uzmanƒ±sƒ±n. "${prompt}" konusunda ${duration} saniyelik bir video i√ßin ≈üunlarƒ± olu≈ütur:

1. ƒ∞lgi √ßekici ba≈ülƒ±k (60 karakterden kƒ±sa, emoji kullan, tƒ±klanma garantili)
2. SEO optimizasyonlu a√ßƒ±klama (200 karakter, anahtar kelimeler i√ßersin)
3. 10 viral etiket (#i≈üaretiyle)
4. ${Math.ceil(duration / 10)} sahne (her biri i√ßin: s√ºre, g√∂rsel a√ßƒ±klamasƒ±, ekranda g√∂sterilecek metin, ge√ßi≈ü efekti)
5. Viral skor (1-10) ve neden viral olacaƒüƒ±nƒ±n kƒ±sa a√ßƒ±klamasƒ±
6. Hedef kitle ve yayƒ±nlama stratejisi

Yanƒ±tƒ± JSON formatƒ±nda ver:
{
  "title": "...",
  "description": "...",
  "tags": ["#tag1", ...],
  "scenes": [
    {"duration": 10, "visual": "...", "text": "...", "transition": "fade/slide/zoom"}
  ],
  "viralScore": 8,
  "viralReason": "...",
  "targetAudience": "...",
  "postingStrategy": "..."
}`;

                const content = await callGemini(apiKey, aiPrompt);
                
                updateProgress(30, 'G√∂rseller aranƒ±yor...');
                
                // Step 2: Search images for each scene
                const scenesWithImages = await Promise.all(content.scenes.map(async (scene, i) => {
                    updateProgress(30 + (i / content.scenes.length) * 20, `Sahne ${i+1} i√ßin g√∂rsel aranƒ±yor...`);
                    const imageUrl = await searchImage(scene.visual);
                    return { ...scene, imageUrl };
                }));

                updateProgress(50, 'Video render ediliyor...');

                // Step 3: Render Video
                const videoBlob = await renderVideo(content, scenesWithImages, format, duration);
                
                updateProgress(90, 'Sonlandƒ±rƒ±lƒ±yor...');

                // Save project
                currentProject = {
                    id: Date.now(),
                    prompt,
                    format,
                    duration,
                    content,
                    scenes: scenesWithImages,
                    videoUrl: URL.createObjectURL(videoBlob),
                    createdAt: new Date().toISOString()
                };

                // Display results
                displayResults(currentProject);
                
                // Save to library
                saveToLibrary(currentProject);

                updateProgress(100, 'Tamamlandƒ±!');
                setTimeout(hideProgress, 500);

            } catch (error) {
                alert('Hata: ' + error.message);
                console.error(error);
            } finally {
                isGenerating = false;
                btn.disabled = false;
                btn.classList.remove('loading');
                btn.innerHTML = '<span>‚ú®</span><span>Otomatik Video Olu≈ütur</span>';
            }
        }

        async function callGemini(apiKey, prompt) {
            const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=' + apiKey, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { temperature: 0.8, maxOutputTokens: 2048 }
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'API hatasƒ±');
            }

            const data = await response.json();
            const text = data.candidates[0].content.parts[0].text;
            
            // Parse JSON
            try {
                const match = text.match(/```json\s*([\s\S]*?)\s*```/) || [null, text];
                return JSON.parse(match[1] || text);
            } catch (e) {
                // Fallback parsing
                return parseContentFromText(text);
            }
        }

        function parseContentFromText(text) {
            // Simple fallback parser
            return {
                title: 'AI Generated Video',
                description: 'Auto-generated content',
                tags: ['#viral', '#trend', '#shorts'],
                scenes: [
                    { duration: 20, visual: 'Technology', text: 'Introduction', transition: 'fade' },
                    { duration: 20, visual: 'Product', text: 'Main Content', transition: 'slide' },
                    { duration: 20, visual: 'Call to Action', text: 'Subscribe', transition: 'zoom' }
                ],
                viralScore: 7,
                viralReason: 'AI generated',
                targetAudience: 'General',
                postingStrategy: 'Post at peak hours'
            };
        }

        async function searchImage(query) {
            // Use Unsplash Source (free, no API key needed for basic usage)
            // Or use Pexels with demo key
            try {
                const response = await fetch(`https://api.pexels.com/v1/search?query=${encodeURIComponent(query)}&per_page=1`, {
                    headers: { 'Authorization': '563492ad6f91700001000001f8c8a0e1a6a94c9b' }
                });
                const data = await response.json();
                if (data.photos && data.photos.length > 0) {
                    return data.photos[0].src.large2x;
                }
            } catch (e) {
                console.log('Image search failed, using placeholder');
            }
            
            // Fallback to placeholder
            return `https://source.unsplash.com/1080x1920/?${encodeURIComponent(query)}`;
        }

        // ==================== VIDEO RENDERING ====================
        async function renderVideo(content, scenes, format, duration) {
            if (!ffmpeg.loaded) {
                updateProgressDetails('FFmpeg y√ºkleniyor...');
                await ffmpeg.load();
            }

            const isVertical = format !== 'youtube';
            const width = isVertical ? 1080 : 1920;
            const height = isVertical ? 1920 : 1080;
            const fps = 30;

            updateProgressDetails('G√∂rseller indiriliyor...');

            // Download and process images
            for (let i = 0; i < scenes.length; i++) {
                const scene = scenes[i];
                updateProgressDetails(`Sahne ${i+1}/${scenes.length} i≈üleniyor...`);
                
                // Fetch image
                const response = await fetch(scene.imageUrl);
                const blob = await response.blob();
                const arrayBuffer = await blob.arrayBuffer();
                
                // Save to FFmpeg
                await ffmpeg.writeFile(`scene_${i}.jpg`, new Uint8Array(arrayBuffer));
                
                // Create video from image with text overlay
                const sceneFrames = Math.floor(scene.duration * fps);
                
                // Generate frames with text
                for (let f = 0; f < sceneFrames; f++) {
                    const progress = f / sceneFrames;
                    
                    // Create canvas frame
                    const canvas = document.createElement('canvas');
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.canvas.getContext('2d');
                    
                    // Draw black background
                    ctx.fillStyle = '#000';
                    ctx.fillRect(0, 0, width, height);
                    
                    // Here we would draw the image and text
                    // For now, create colored frames with text
                    ctx.fillStyle = `hsl(${(i * 60) % 360}, 50%, 20%)`;
                    ctx.fillRect(0, 0, width, height);
                    
                    // Draw text
                    ctx.fillStyle = '#fff';
                    ctx.font = `bold ${isVertical ? 80 : 60}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    
                    // Text animation
                    const yOffset = Math.sin(progress * Math.PI) * 50;
                    ctx.fillText(scene.text, width/2, height/2 + yOffset);
                    
                    // Draw scene number
                    ctx.font = '40px Arial';
                    ctx.fillText(`Sahne ${i+1}`, width/2, height/2 - 100);
                    
                    // Convert to blob and save
                    const frameBlob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg'));
                    const frameBuffer = await frameBlob.arrayBuffer();
                    await ffmpeg.writeFile(`frame_${i}_${f}.jpg`, new Uint8Array(frameBuffer));
                }
            }

            updateProgressDetails('Video birle≈ütiriliyor...');

            // Create concat list
            let concatList = '';
            for (let i = 0; i < scenes.length; i++) {
                const sceneFrames = Math.floor(scenes[i].duration * fps);
                for (let f = 0; f < sceneFrames; f++) {
                    concatList += `file 'frame_${i}_${f}.jpg'\n`;
                }
            }
            await ffmpeg.writeFile('concat.txt', concatList);

            // Render final video
            await ffmpeg.exec([
                '-f', 'concat',
                '-safe', '0',
                '-i', 'concat.txt',
                '-vf', `fps=${fps},format=yuv420p`,
                '-c:v', 'libx264',
                '-preset', 'ultrafast',
                '-crf', '23',
                '-pix_fmt', 'yuv420p',
                '-movflags', '+faststart',
                'output.mp4'
            ]);

            // Read output
            const data = await ffmpeg.readFile('output.mp4');
            
            // Cleanup
            await ffmpeg.deleteDir('.');
            
            return new Blob([data.buffer], { type: 'video/mp4' });
        }

        // ==================== DISPLAY RESULTS ====================
        function displayResults(project) {
            document.getElementById('resultsSection').classList.add('active');
            
            // Content cards
            document.getElementById('videoTitle').textContent = project.content.title;
            document.getElementById('videoDescription').textContent = project.content.description;
            
            const tagsContainer = document.getElementById('videoTags');
            tagsContainer.innerHTML = project.content.tags.map(tag => 
                `<span class="tag">${tag}</span>`
            ).join('');
            
            document.getElementById('viralStrategy').innerHTML = `
                <strong>Neden Viral?</strong> ${project.content.viralReason}<br><br>
                <strong>Hedef Kitle:</strong> ${project.content.targetAudience}<br>
                <strong>Yayƒ±n Stratejisi:</strong> ${project.content.postingStrategy}
            `;
            
            // Viral score
            const score = project.content.viralScore;
            const badge = document.getElementById('viralScore');
            badge.textContent = `Viral: ${score}/10`;
            badge.className = 'viral-badge ' + (score >= 8 ? 'high' : score >= 5 ? 'medium' : 'low');
            
            // Scenes
            const scenesList = document.getElementById('scenesList');
            scenesList.innerHTML = project.scenes.map((scene, i) => `
                <div class="scene-item">
                    <div class="scene-number">${i+1}</div>
                    <div class="scene-content">
                        <div class="scene-time">${scene.duration} saniye ‚Ä¢ ${scene.transition} ge√ßi≈ü</div>
                        <div class="scene-text">${scene.text}</div>
                        <div class="scene-visual">üé¨ ${scene.visual}</div>
                    </div>
                    <img src="${scene.imageUrl}" style="width: 120px; height: 80px; object-fit: cover; border-radius: 8px;" 
                         onerror="this.style.display='none'">
                </div>
            `).join('');
            
            // Video player
            const container = document.getElementById('videoContainer');
            container.innerHTML = `
                <video id="videoPlayer" style="width: 100%; height: 100%; object-fit: contain;">
                    <source src="${project.videoUrl}" type="video/mp4">
                </video>
            `;
            
            document.getElementById('downloadBtn').disabled = false;
            document.getElementById('videoInfo').textContent = `${project.duration}s ‚Ä¢ ${project.format.toUpperCase()}`;
            
            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        // ==================== VIDEO CONTROLS ====================
        function playVideo() {
            const video = document.getElementById('videoPlayer');
            const btn = document.getElementById('playBtn');
            
            if (video.paused) {
                video.play();
                btn.innerHTML = '‚è∏Ô∏è Durdur';
            } else {
                video.pause();
                btn.innerHTML = '‚ñ∂Ô∏è Oynat';
            }
        }

        function downloadVideo() {
            if (!currentProject) return;
            
            const a = document.createElement('a');
            a.href = currentProject.videoUrl;
            a.download = `melez_${currentProject.content.title.replace(/[^a-z0-9]/gi, '_').substring(0, 30)}.mp4`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function deleteVideo() {
            if (!confirm('Bu videoyu silmek istediƒüinize emin misiniz?')) return;
            
            document.getElementById('resultsSection').classList.remove('active');
            currentProject = null;
        }

        // ==================== LIBRARY ====================
        function saveToLibrary(project) {
            // Save metadata (not the blob)
            const libraryItem = {
                id: project.id,
                prompt: project.prompt,
                title: project.content.title,
                format: project.format,
                duration: project.duration,
                viralScore: project.content.viralScore,
                createdAt: project.createdAt,
                thumbnail: project.scenes[0]?.imageUrl || ''
            };
            
            videoLibrary.unshift(libraryItem);
            localStorage.setItem('melezVideos', JSON.stringify(videoLibrary));
            updateLibrary();
        }

        function updateLibrary() {
            const grid = document.getElementById('videoGrid');
            
            if (videoLibrary.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 60px; color: var(--text-secondary);">
                        <div style="font-size: 4rem; margin-bottom: 20px;">üìÅ</div>
                        <p>Hen√ºz video olu≈üturmadƒ±nƒ±z</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = videoLibrary.map(video => `
                <div class="video-card" onclick="showVideoDetails(${video.id})">
                    <div class="video-thumb">
                        ${video.thumbnail ? `<img src="${video.thumbnail}" onerror="this.style.display='none'">` : ''}
                        <div style="font-size: 3rem;">üé¨</div>
                        <span class="video-duration">${video.duration}s</span>
                    </div>
                    <div class="video-info">
                        <div class="video-title">${video.title}</div>
                        <div class="video-meta">
                            <span>${new Date(video.createdAt).toLocaleDateString('tr-TR')}</span>
                            <span class="viral-badge ${video.viralScore >= 8 ? 'high' : 'medium'}">
                                ${video.viralScore}/10
                            </span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function showVideoDetails(id) {
            // In a real app, you'd retrieve the full video from storage
            // For now, show a message
            alert('Video detaylarƒ± i√ßin olu≈üturma sayfasƒ±na gidin');
        }

        function clearLibrary() {
            if (!confirm('T√ºm videolarƒ± silmek istediƒüinize emin misiniz?')) return;
            videoLibrary = [];
            localStorage.removeItem('melezVideos');
            updateLibrary();
        }

        // ==================== UTILITIES ====================
        function showProgress(title, percent) {
            document.getElementById('progressOverlay').classList.add('active');
            document.getElementById('progressTitle').textContent = title;
            updateProgress(percent, '');
        }

        function updateProgress(percent, status) {
            document.getElementById('progressFill').style.width = percent + '%';
            if (status) document.getElementById('progressStatus').textContent = status;
        }

        function updateProgressDetails(details) {
            document.getElementById('progressDetails').textContent = details;
        }

        function hideProgress() {
            document.getElementById('progressOverlay').classList.remove('active');
        }

        function copyContent(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('üìã Kopyalandƒ±!');
            });
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        function showSettings() {
            alert('Ayarlar: API Key otomatik kaydedilir. T√ºm veriler tarayƒ±cƒ±nƒ±zda saklanƒ±r.');
        }

        function closeModal() {
            document.getElementById('previewModal').classList.remove('active');
        }
    </script>
</body>
</html>
